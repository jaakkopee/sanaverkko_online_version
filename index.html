<!DOCTYPE html>
<html>
<head>
    <title>SanaVerkko</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="SanaVerkko, a text generation tool that produces sentences that match in different gematria ciphers.">
    <meta name="keywords" content="gematria, text generation, text analysis, text matching, text comparison, text similarity, text generation tool, text analysis tool, text matching tool, text comparison tool, text similarity tool">
    <meta name="author" content="Jaakko Prättälä">
    <!-- import p5.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <!-- import sanaverkko script -->
    <script src="sanaverkko.js"></script>
</head>
<body>
    <script>
        //some globals
        windowWidth = 1024;
        windowHeight = 768;
        // create a new instance of Sanaverkko
        const sanaverkko = new Network();
        sanaverkko.setWordGenerationThreshold(0.5);
        sanaverkko.setActivationChangeFactor(0.5);
        sanaverkko.setLearningRate(0.5);
        sanaverkko.setErrorInfluenceFactor(0.5);
        sanaverkko.setSigmoidScale(0.5);
        sanaverkko.setSetWeightsByGematria(false);
        sanaverkko.addSentence("The quick brown fox jumps over the lazy dog.");
        sanaverkko.setZoom(1);

        //html elements, added to dom
        var input;
        var button;
        var slider;
        var slider2;
        var slider3;
        var slider4;
        var slider5;
        var slider6;
        var slider7;
        var slider8;
        var tickbox;

        //parameter monitoring
        dom = document.createElement("p");
        dom.innerHTML = "Word generation threshold";
        document.body.appendChild(dom);
        dom.style.position = "absolute";
        dom.style.left = "10px";
        dom.style.top = "10px";
        dom.style.color = "white";
        dom.id = "wordGenerationThreshold";

        dom = document.createElement("p");
        dom.innerHTML = "Activation change factor";
        document.body.appendChild(dom);
        dom.style.position = "absolute";
        dom.style.left = "10px";
        dom.style.top = "40px";
        dom.style.color = "white";
        dom.id = "activationChangeFactor";

        dom = document.createElement("p");
        dom.innerHTML = "Learning rate";
        document.body.appendChild(dom);
        dom.style.position = "absolute";
        dom.style.left = "10px";
        dom.style.top = "70px";
        dom.style.color = "white";
        dom.id = "learningRate";

        dom = document.createElement("p");
        dom.innerHTML = "Error influence factor";
        document.body.appendChild(dom);
        dom.style.position = "absolute";
        dom.style.left = "10px";
        dom.style.top = "100px";
        dom.style.color = "white";
        dom.id = "errorInfluenceFactor";

        dom = document.createElement("p");
        dom.innerHTML = "Sigmoid scale";
        document.body.appendChild(dom);
        dom.style.position = "absolute";
        dom.style.left = "10px";
        dom.style.top = "130px";
        dom.style.color = "white";
        dom.id = "sigmoidScale";

        dom = document.createElement("p");
        dom.innerHTML = "Zoom";
        document.body.appendChild(dom);
        dom.style.position = "absolute";
        dom.style.left = "10px";
        dom.style.top = "160px";
        dom.style.color = "white";
        dom.id = "zoom";

        dom = document.createElement("p");
        dom.innerHTML = "Sentence generation threshold";
        document.body.appendChild(dom);
        dom.style.position = "absolute";
        dom.style.left = "10px";
        dom.style.top = "190px";
        dom.style.color = "white";
        dom.id = "sentenceGenerationThreshold";

        dom = document.createElement("p");
        dom.innerHTML = "Target activation";
        document.body.appendChild(dom);
        dom.style.position = "absolute";
        dom.style.left = "10px";
        dom.style.top = "220px";
        dom.style.color = "white";
        dom.id = "targetActivation";



        function createInput(x, y) {
            var dom = document.createElement("input");
            dom.type = "text";
            document.body.appendChild(dom);
            dom.addEventListener("keydown", function(event) {
                if (event.key === "Enter") {
                    sanaverkko.addSentence(dom.value);
                    dom.value = "";
                }
            });
            //position the input element
            dom.style.position = "absolute";
            dom.style.left = x + "px";
            dom.style.top = y + "px";
            return dom;

        }

        function createButton(value, x, y) {
            var dom = document.createElement("button");
            dom.innerHTML = value;
            document.body.appendChild(dom);
            dom.addEventListener("click", function() {
                sanaverkko.addSentence(input.value);
                input.value = "";
            });
            //position the button element
            dom.style.position = "absolute";
            dom.style.left = x + "px";
            dom.style.top = y + "px";
            return dom;

        }

        function createSlider(min, max, value, step, x, y) {
            var dom = document.createElement("input");
            dom.type = "range";
            dom.min = min;
            dom.max = max;
            dom.value = value;
            dom.step = step;
            //event listener for slider
            dom.addEventListener("input", function() {
                if (dom === slider) {
                    var value = dom.value*200;
                    sanaverkko.setWordGenerationThreshold(value);
                    monitor = document.getElementById("wordGenerationThreshold");
                    monitor.innerHTML = "Word generation threshold: " + value;

                } else if (dom === slider2) {
                    sanaverkko.setActivationChangeFactor(dom.value);
                    monitor = document.getElementById("activationChangeFactor");
                    monitor.innerHTML = "Activation change factor: " + dom.value;

                } else if (dom === slider3) {
                    sanaverkko.setLearningRate(dom.value);
                    monitor = document.getElementById("learningRate");
                    monitor.innerHTML = "Learning rate: " + dom.value;

                } else if (dom === slider4) {
                    sanaverkko.setErrorInfluenceFactor(dom.value);
                    monitor = document.getElementById("errorInfluenceFactor");
                    monitor.innerHTML = "Error influence factor: " + dom.value;

                } else if (dom === slider5) {
                    var value = dom.value*200;
                    sanaverkko.setSigmoidScale(value);
                    monitor = document.getElementById("sigmoidScale");
                    monitor.innerHTML = "Sigmoid scale: " + value;

                } else if (dom === slider6) {
                    sanaverkko.setZoom(dom.value);
                    monitor = document.getElementById("zoom");
                    monitor.innerHTML = "Zoom: " + dom.value;

                } else if (dom === slider7) {
                    var value = dom.value*2;
                    sanaverkko.setSentenceGenerationThreshold(value);
                    monitor = document.getElementById("sentenceGenerationThreshold");
                    monitor.innerHTML = "Sentence generation threshold: " + value
                }
                else if (dom === slider8) {
                    sanaverkko.setTarget(dom.value);
                    monitor = document.getElementById("targetActivation");
                    monitor.innerHTML = "Target activation: " + dom.value;
                }
            });
            document.body.appendChild(dom);
            //position the slider element
            dom.style.position = "absolute";
            dom.style.left = x + "px";
            dom.style.top = y + "px";
            return dom;
        }




        //create html elements
        function createElements() {
            input = createInput(10, 250);
            button = createButton("Add sentence", 10, 280);
            slider = createSlider(0, 1, 0.5, 0.01, 200, 10);
            slider2 = createSlider(0, 1, 0.5, 0.01, 200, 40);
            slider3 = createSlider(0, 1, 0.5, 0.01, 200, 70);
            slider4 = createSlider(0, 1, 0.5, 0.01, 200, 100);
            slider5 = createSlider(0, 1, 0.5, 0.01, 200, 130);
            slider6 = createSlider(0, 1, 0.5, 0.01, 200, 160);
            slider7 = createSlider(0, 1, 0.5, 0.01, 200, 190);
            slider8 = createSlider(-5, 5, 0, 0.01, 200, 220);
            tickbox = document.createElement("input");
            tickbox.type = "checkbox";
            document.body.appendChild(tickbox);
            tickbox.style.position = "absolute";
            tickbox.style.left = "200";
            tickbox.style.top = "190";
        }
        //add sliders to dom
        createElements();

        //create generated sentence log display
        var log = document.createElement("p");
        log.innerHTML = "Generated sentences:";
        document.body.appendChild(log);
        log.style.position = "absolute";
        log.style.left = "10px";
        log.style.top = "300px";
        log.style.color = "white";
        log.id = "log";

        function logSentence() {
            var log = document.getElementById("log");
            log.innerHTML += "<br>" + sanaverkko.generatedSentence;
            if (log.innerHTML.length > 1000) {
                log.innerHTML = "Generated sentences:";
            }
        }

        //read db
        readDB("nsoe.txt");

        setup = () => {
            createCanvas(windowWidth, windowHeight);
        }

        draw = () => {
            sanaverkko.update();
            //if sanaverkko has generated a sentence, log it
            if (sanaverkko.generatedSentence != "") {
                logSentence();
            }
            background(0);
            for (let i = 0; i < sanaverkko.words.length; i++) {
                var x = sanaverkko.words[i].x;
                var y = sanaverkko.words[i].y;
                //first draw the connections
                for (let j = 0; j < sanaverkko.words[i].connections.length; j++) {
                    var connection = sanaverkko.words[i].connections[j];
                    var x2 = connection.word.x;
                    var y2 = connection.word.y;
                    console.log("drawing connection from " + x + ", " + y + " to " + x2 + ", " + y2);
                    if (connection.weight > 0) {
                        stroke(255*abs(connection.weight)%255, 0, 0);
                    } else {
                        stroke(0, 0, 255*abs(connection.weight)%255);
                    }
                    strokeWeight(5);
                    line(x, y, x2, y2);
                }
                strokeWeight(1);
                stroke(0);

                //then draw neural circles, words and activations
                if (sanaverkko.words[i].activation < 0) {
                    fill(0, 127, 255*abs(sanaverkko.words[i])%255);
                } else {
                    fill(255*abs(sanaverkko.words[i].activation)%255 , 127, 0);
                }
                ellipse(x, y, 50, 50);
                fill(255);
                textSize(20);
                text(sanaverkko.words[i].string, x-10, y);
                textSize(10);
                text(sanaverkko.words[i].activation, x-10, y+20);
            }
        }
    </script>


